<!DOCTYPE html>
<html lang="pt-br">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="shortcut icon" href="assets/img/logo-go-blue.svg" type="image/png">
    <script src="https://kit.fontawesome.com/c9f71e3f63.js" crossorigin="anonymous"></script>
    <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
    <title>Publicar | GO</title>

    <link rel="stylesheet" href="./assets/css/style.modais.css">
    <link rel="stylesheet" href="./assets/css/style.nav.css">
    <link rel="stylesheet" href="./assets/css/feed.css">
    <link rel="stylesheet" href="./assets/css/style-components.css">
    <link rel="stylesheet" href="./assets/css/search.css">
    <link rel="stylesheet" href="./assets/css/publication.css">
    <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
</head>

<body onload="iniciar()">
    <!------------------------------------------------------------------------- NAVBAR ------------------------------------------------------------------------->
    <!-- navbar desktop -->
    <section class="nav__desktop">
        <div class="nav__desktop__top">
            <div class="nav__desktop__top__items">
                <span id="logo">
                    <img src=".//assets/img/logo-go-carbon.svg" alt="">
                </span>
                <span class="nav__desktop__search">
                    <input type="search" id="uriParamComplaint" placeholder="Busque pela placa ou nome do motorista">
                    <select name="" id="endPointComplaint" aria-placeholder="Filtrar por">
                        <option value="license">Placa</option>
                        <option value="city">Cidade</option>
                        <option value="district">Bairro</option>
                        <option value="state">Estado</option>
                    </select>
                    <a class="search__icon" onclick="getSearch()"> <i
                            class="fa-solid fa-magnifying-glass icon__mobile__search"></i></a>
                </span>
            </div>
            <div class="nav__desktop__top__items">
                <div class="mobile-bottom-nav__item mobile-bottom-nav__item">
                    <div class="mobile-bottom-nav__item-content links__desktop">
                        <a href="./index.html"><i class="fa-solid fa-house icon__mobile"></i></a>
                    </div>
                </div>
                <div class="mobile-bottom-nav__item">
                    <div class="mobile-bottom-nav__item-content links__desktop">
                        <a href="./perfil.html"><i class="fa-solid fa-user icon__mobile"></i></a>
                    </div>
                </div>

                <div class="nav__itens__links">
                    <div class="mobile-bottom-nav__item-content links__desktop">
                        <label for="modal-4">
                            <i class="fa-solid fa-bell icon__mobile"></i>
                        </label>
                    </div>
                </div>

                <div class="nav__itens__links">
                    <div class="mobile-bottom-nav__item-content">
                        <label for="modal-1">
                            <i class="fa-solid fa-caret-down icon__mobile js-open-modal"></i>
                        </label>
                    </div>
                </div>
                <div class="mobile-bottom-nav__item-content">
                    <div class="icon__user__initial">
                        <span class="initial__user" id="initial">R</span>
                    </div>
                </div>
            </div>
        </div>
        </div>
    </section>
    <!-- navbar mobile -->
    <section class="nav__mobile">
        <div class="nav__mobile__top">
            <div class="">
                <div class="mobile-bottom-nav__item-content">
                    <span id="logoMobile">
                        <img src=".//assets/img/logo-go-carbon.svg" alt="">
                    </span>
                </div>
            </div>

            <div class="mobile-bottom-nav__item mobile-bottom-nav__item">
                <div class="mobile-bottom-nav__item-content">
                    <h3>Publicar</h3>
                </div>
            </div>

            <div class="">
                <div class="mobile-bottom-nav__item-content">
                    <label for="modal-4">
                        <i class="fa-solid fa-bell icon__mobile"></i>
                    </label>
                </div>
            </div>
        </div>
    </section>
    <!--------------------------------------------------------------------- /NAVBAR --------------------------------------------------------------------------->

    <!--------------------------------------------------------------------- CONTEUDO --------------------------------------------------------------------------->
    <main>
        <section>
            <div class="container__form form__publication">
                <div class="inputs__publication">
                    <!-- tópico -->
                    <div class="topic__feed flex justify">
                        <span class="flex">
                            <p><b>Nova Publicação</b></p>
                        </span>
                        <div class="hr"></div>
                    </div>


                    <form>
                        <div class="scrool_form">
                            <div>
                                <label for="Descrição">Descrição</label>
                                <textarea name="" id="description" rows="6" placeholder="Descreva o ocorrido" onkeypress="validateDescription(description.value)"></textarea>
                                <span id="post_descricao" style="display: none; color:rgb(253, 81, 81); margin-bottom: 18px">Descrição vazia</span>
                            </div>
                            <div class="form__publication">

                                <div class="ipt__form">
                                    <label for="Data do ocorrido">Data do ocorrido</label>
                                    <input type="date" name="" id="dateTimeComplaint">
                                </div>

                                <div class="ipt__form">
                                    <label for="codigo do boletim">codigo do boletim</label>
                                    <input type="text" name="" id="bo"
                                        placeholder="Insira o código do boletim de ocorrencia">
                                </div>

                            </div>

                            <div class="form__publication">

                                <div class="ipt__form">
                                    <label for="CEP">CEP</label>
                                    <input type="text" name="" id="cep" placeholder="Ponto de partida ou Destino">
                                    <span id="endereco_validator" style="color: rgb(253, 81, 81);
                                    display: none; margin-top: 5px"></span>
                                </div>

                                <div class="ipt__form">
                                    <label for="codigo do boletom">Estado onde ocorreu</label>
                                    <input type="text" id="uf" class="form_sel">
                                    <!--<select class="form__sel" name="combo_state" id="district">
                                        <option value="AC">AC</option>
                                        <option value="AL">AL</option>
                                        <option value="AP">AP</option>
                                        <option value="AM">AM</option>
                                        <option value="BA">BA</option>
                                        <option value="CE">CE</option>
                                        <option value="DF">DF</option>
                                        <option value="ES">ES</option>
                                        <option value="GO">GO</option>
                                        <option value="MA">MA</option>
                                        <option value="MT">MT</option>
                                        <option value="MS">MS</option>
                                        <option value="MG">MG</option>
                                        <option value="PA">PA</option>
                                        <option value="PB">PB</option>
                                        <option value="PR">PR</option>
                                        <option value="PE">PE</option>
                                        <option value="PI">PI</option>
                                        <option value="RJ">RJ</option>
                                        <option value="RN">RN</option>
                                        <option value="RS">RS</option>
                                        <option value="RO">RO</option>
                                        <option value="RR">RR</option>
                                        <option value="SC">SC</option>
                                        <option value="SP">SP</option>
                                        <option value="SE">SE</option>
                                        <option value="TO">TO</option>
                                    </select>-->
                                </div>

                            </div>
                            <div class="form__publication">
                                <div class="ipt__form">
                                    <label for="Cidade onde ecorreu">Cidade onde ocorreu</label>
                                    <input type="text" name="" id="city"
                                        placeholder="Insira a cidade onde o caso ocorreu">
                                </div>

                                <div class="ipt__form">
                                    <label for="Bairro onde ecorreu">Bairro onde ocorreu</label>
                                    <input type="text" name="" id="district" placeholder="Insira a Bairro onde o caso ocorreu">
                                </div>
                            </div>
                            <div class="form__publication">
                                <div class="ipt__form">
                                    <label for="Nome do motorista">Nome do(a) motorista</label>
                                    <input type="text" name="driverName" id="driverName" placeholder="Insira o nome do motorista" onkeypress="validateDriverName(driverName.value)">
                                    <span id="post_motorista" style="display: none; color:rgb(253, 81, 81)">
                                        Insira o nome do motorista
                                    </span>
                                </div>

                                <div class="ipt__form">
                                    <label for="Placa do veiculo">Placa do veiculo</label>
                                    <input type="text" name="" id="licensePlate"
                                        placeholder="Insira a placa do veiculo" onkeypress="validateLicensePlate(licensePlate.value)">
                                    <span id="post_placa" style="display: none; color:rgb(253, 81, 81)">
                                        Insira uma placa válida
                                    </span>
                                </div>
                            </div>
                        </div>
                </div>
                <div class="more__inputs justify__more__infos">
                    <div>
                        <div class="form__publication">
                            <div class="ipt__form">
                                <label for="codigo do boletom">Classificação do Caso</label>
                                <select class="form__sel" name="" id="type">
                                    <option value="Assédio">Assédio</option>
                                    <option value="Assédio Moral">Assédio Moral</option>
                                    <option value="Racismo">Racismo</option>
                                    <option value="Agressão Física">Agressão Física</option>
                                    <option value="Agressão Verbal">Agressão Verbal</option>
                                    <option value="Homofobia">Homofobia</option>
                                    <option value="Preconceito">Preconceito</option>
                                    <option value="Furto">Furto</option>
                                </select>
                            </div>
                        </div>
                        <div class="card__arq padding__card">
                            <h4>Adicionar Midia</h4>
                            <button >
                                <form id="upload-form" action="" method="post" enctype="multipart/form-data">
                                    <input id="selected-image" type="file" id="myFile" name="filename">
                                    Anexar Arquivo
                                    <input type="submit" value="Upload image" name="submit">
                                </form>
                            </button>
                            <h6>Deixe a sua denuncia ainda mais completa, adicionando print do aplicativo, foto do
                                motorista, video ou foto do boletim de ocorrencia.</h6>
                        </div>
                    </div>

                    <div>
                        <button onclick="registerComplaints()" class="btn__publication">
                            Publicar
                        </button>

                        <div class="card__dics padding__card">
                            <h6>Seus dados não são visiveis para outros usuarios. Tomamos todos os cuidados para
                                garantir sua segurança, verifique suas imagens adicionadas e garanta que nenhum dado seu
                                vaze.</h6>
                        </div>
                    </div>
                    </form>
                </div>
        </section>
        <div style="display: none;" class="toggle">
            <input type="checkbox" id="switch" name="theme" onclick="mudar_logo()">
            <label for="switch">Toggle</label>
        </div>

        <!---------------------------------------------------------------------- MODAIS -------------------------------------------------------------------------->

        <!---------------------------------------------------------------------- MODAIS -------------------------------------------------------------------------->

        <!-- modal navbar / mains opções de link -->
        <input class="modal-state" id="modal-1" type="checkbox" />
        <div class="modal">
            <label class="modal__bg" for="modal-1"></label>
            <div class="modal__inner">
                <a class="options__modal__user" href="./perfil-save.html">Casos salvos</a>
                <a class="options__modal__user" href="./perfil-contestation.html">Denuncias em analise</a>
                <a class="options__modal__user" href="./config-infos.html">Configurações</a>
                <hr>
                <span class="flex justify">
                    <a class="options__modal__user" href="../forms-go/login.html">Sair</a>
                    <i class="fa-solid fa-arrow-right-from-bracket"></i>
                </span>
            </div>
        </div>

        <!-- modal / notificações -->
        <input class="modal-state" id="modal-4" type="checkbox" />
        <div class="modal">
            <label class="modal__bg" for="modal-4"></label>
            <div class="modal__inner__notify padding__card">
                <div class="content__notify">
                    <h5>Seu caso foi removido</h5>
                    <span class="date">23/02/2022</span>
                    <p>Analizamos sua publicação mediante ao pedido feito pelo motorista denunciado e optamos por
                        exclui-la.</p>
                    <a href="#">Saiba Mais</a>
                    <hr>
                </div>

                <div class="content__notify">
                    <h5>Seu caso foi removido</h5>
                    <span class="date">23/02/2022</span>
                    <p>Analizamos sua publicação mediante ao pedido feito pelo motorista denunciado e optamos por
                        exclui-la.</p>
                    <a href="#">Saiba Mais</a>
                    <hr>
                </div>

                <div class="content__notify">
                    <h5>Seu caso foi removido</h5>
                    <span class="date">23/02/2022</span>
                    <p>Analizamos sua publicação mediante ao pedido feito pelo motorista denunciado e optamos por
                        exclui-la.</p>
                    <a href="#">Saiba Mais</a>
                    <hr>
                </div>

                <div class="content__notify">
                    <h5>Seu caso foi removido</h5>
                    <span class="date">23/02/2022</span>
                    <p>Analizamos sua publicação mediante ao pedido feito pelo motorista denunciado e optamos por
                        exclui-la.</p>
                    <a href="#">Saiba Mais</a>
                    <hr>
                </div>

                <div class="content__notify">
                    <h5>Seu caso foi removido</h5>
                    <span class="date">23/02/2022</span>
                    <p>Analizamos sua publicação mediante ao pedido feito pelo motorista denunciado e optamos por
                        exclui-la.</p>
                    <a href="#">Saiba Mais</a>
                    <hr>
                </div>
            </div>
        </div>

        <!-- modal classificação dos casos -->
        <input class="modal-state" id="modal-5" type="checkbox" />
        <div class="modal modal__classific">
            <label class="modal__bg__search" for="modal-5"></label>
            <div class="modal__inner__classific padding__card ">
                <h5>Classificação dos casos</h5>
                <p class="desc__cases__type">Aqui na GO as denúncias são classificadas, facilitando para que você faça a
                    sua denúncia e também
                    para que visualize de forma mais rápida o tipo de caso que está lendo.</p>
                <div class="card__more__class">
                    <div class="top__classification classification__complaint">
                        <div class="circle__assedio circle__classification"></div>
                        <h5>Assédio</h5>
                    </div>
                    <p class="desc__classfication">De acordo com a lei, o assédio é crime quando praticado por superior
                        hierárquico ou ascendente. Há duas interpretações em relação à prática do ato: o assédio pode
                        ocorrer pelo simples constrangimento da vítima ou pela prática contínua de atos constrangedores.
                    </p>
                    <hr>
                </div>

                <div class="card__more__class">
                    <div class="top__classification classification__complaint">
                        <div class="circle__assedio__moral circle__classification"></div>
                        <h5>Assédio Moral</h5>
                    </div>
                    <p class="desc__classfication">assédio moral é definido como “ofensa reiterada da dignidade de
                        alguém que cause danos ou sofrimento físico ou mental no exercício do emprego, cargo ou função”.
                    </p>
                    <hr>
                </div>

                <div class="card__more__class">
                    <div class="top__classification classification__complaint">
                        <div class="circle__racism circle__classification"></div>
                        <h5>Racismo</h5>
                    </div>
                    <p class="desc__classfication">Racismo é definido como “Praticar, induzir ou incitar a discriminação
                        ou preconceito de raça, cor, etnia, religião ou procedência nacional.”.
                    </p>
                    <hr>
                </div>

                <div class="card__more__class">
                    <div class="top__classification classification__complaint">
                        <div class="circle__agressao__fisica circle__classification"></div>
                        <h5>Agressão Fisica</h5>
                    </div>
                    <p class="desc__classfication">
                        É caracterizada como qualquer ação que ofenda a integridade e saúde do corpo da vítima. São
                        considerados atos de violência física: espancamentos, lesões causadas por objetos, empurrões,
                        beliscões, pontapés, ou qualquer outra forma de agressão.
                    </p>
                    <hr>
                </div>

                <div class="card__more__class">
                    <div class="top__classification classification__complaint">
                        <div class="circle__agressao__verbal circle__classification"></div>
                        <h5>Agressão Verbal</h5>
                    </div>
                    <p class="desc__classfication">
                        A violência verbal é um comportamento agressivo, caracterizado por palavras danosas, que têm a
                        intenção de ridicularizar, humilhar, manipular e/ou ameaçar.
                    </p>
                    <hr>
                </div>

                <div class="card__more__class">
                    <div class="top__classification classification__complaint">
                        <div class="circle__homofobia circle__classification"></div>
                        <h5>Homofobia</h5>
                    </div>
                    <p class="desc__classfication">
                        "praticar, induzir ou incitar a discriminação ou preconceito" em razão da orientação sexual da
                        pessoa pode ser considerado homofobia.
                    </p>
                    <hr>
                </div>

                <div class="card__more__class">
                    <div class="top__classification classification__complaint">
                        <div class="circle__preconceito circle__classification"></div>
                        <h5>Preconceito</h5>
                    </div>
                    <p class="desc__classfication">
                        Praticar, induzir ou incitar a discriminação ou preconceito de raça, cor, etnia, religião ou
                        procedência nacional. Pena: reclusão de um a três anos e multa.
                    </p>
                    <hr>
                </div>

                <div class="card__more__class">
                    <div class="top__classification classification__complaint">
                        <div class="circle__furto circle__classification"></div>
                        <h5>Furto</h5>
                    </div>
                    <p class="desc__classfication">
                        O crime de furto é descrito como subtração, ou seja, diminuição do patrimônio de outra pessoa,
                        sem que haja violência
                    </p>
                    <hr>
                </div>
            </div>
        </div>

        <!-- modal de busca -->
        <span class="display__modal">
            <input class="modal-state" id="modal-2" type="checkbox" />
            <div class="modal modal__search">
                <label class="modal__bg__search" for="modal-2"></label>
                <div class="modal__inner__search">
                    <div>
                        <p>Faça sua busca</p>
                        <span class="nav__mobile__input">
                            <input type="search" id="uriParamComplaint" placeholder="Busque pela placa ou nome do motorista">
                            <select name="" id="endPointComplaint" aria-placeholder="Filtrar por">
                                <option value="license">Placa</option>
                                <option value="">Nome/Placa</option>
                                <option value="city">Cidade</option>
                                <option value="district">Bairro</option>
                                <option value="state">Estado</option>
                            </select>
                            <a class="search__icon" onclick="getSearch()"> <i
                                style="margin-top: 2px; padding-left: 10px; text-decoration: none; color: rgb(94, 94, 94);"></i></a>
                        </span>
                    </div>
                </div>
            </div>
        </span>

    </main>

    <!----------------------------------------------------------------------- MENU -------------------------------------------------------------------------->
    <section class="nav__mobile">
        <nav class="mobile-bottom-nav">
            <div class="mobile-bottom-nav__item">
                <div class="mobile-bottom-nav__item-content">
                    <a href="./index.html"><i class="fa-solid fa-house icon__mobile"></i></a>
                </div>
            </div>
            <div class="nav__itens__links ">
                <div class="mobile-bottom-nav__item-content ">
                    <label for="modal-2">
                        <i class="fa-solid fa-magnifying-glass icon__mobile"></i>
                    </label>
                </div>
            </div>
            <div class="mobile-bottom-nav__item">
                <div class="mobile-bottom-nav__item-content">
                    <a href="./perfil.html"><i class="fa-solid fa-user icon__mobile"></i></a>
                </div>
            </div>

            <div class="nav__itens__links">
                <div class="mobile-bottom-nav__item-content">
                    <label for="modal-1">
                        <i class="fa-solid fa-angle-up icon__mobile"></i>
                    </label>
                </div>
            </div>
        </nav>
    </section>
    <script src="./assets/js/script-components.js"></script>
    <script src="./assets/js/dark-mode.js"></script>
</body>

</html>
<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js" type="text/javascript"></script>
<script>
    function getSearch(){
        let uriParam = document.getElementById('uriParamComplaint').value;
        let endPoint = document.getElementById('endPointComplaint').value;
        sessionStorage.setItem('uriParamComplaint', uriParam);
        sessionStorage.setItem('endPointComplaint', endPoint);
        window.location.href = "./search.html";
    }

    function iniciar() {
        document.getElementsByClassName("icon__user__initial")[0].style.backgroundColor = sessionStorage.user_colorProfile;
        initial.innerHTML = sessionStorage.user_nome[0]
    }

    function registerComplaints() {
        event.preventDefault();
        //var dataTempo = new Date();
        var dateTime = dateTimeComplaint.value;
        /*dateTime += `T${dataTempo.getHours()}:${dataTempo.getMinutes()}:20.462Z"`;*/
        console.log(dateTime);
        const data = {
            type: type.value,
            description: description.value,
            archive: "string",
            bo: bo.value,
            driverName: driverName.value,
            licensePlate: licensePlate.value,
            state: uf.value,
            city: city.value,
            district: district.value,
            dateTimeComplaint: dateTime
        }
        validateData(data);
        axios.post(`http://localhost:8080/complaints/${sessionStorage.user_id}`, data)
            .then((resp) => {
                alert('Denúncia publicada com sucesso', resp);
                getId();
                window.location.href = './index.html';
            })
            .catch((error) => {
                console.log(error);
                console.log(data);
                window.location.href = './error.html';
            })
    }

    function validateData(data){
        if(data.description == ""){
            document.getElementById('post_descricao').style.display = 'block';
        }
        if (data.licensePlate.length < 5){
            document.getElementById('post_placa').style.display = 'block';
        }
        if(data.driverName.length < 4){
            document.getElementById('post_motorista').style.display = 'block';
        }
        if(cep.value.length < 3){
            document.getElementById('endereco_validator').style.display = 'block';
            document.getElementById('endereco_validator').innerHTML = 'CEP inválido';
        }
    }

    function validateDriverName(driverName){
        if(driverName.length < 3){
            document.getElementById('post_motorista').style.display = 'block';
        } else{
            document.getElementById('post_motorista').style.display = 'none';
        }
    }

    function validateDescription(description){
        if(description.length < 6){
            document.getElementById('post_descricao').style.display = 'block';
        } else{
            document.getElementById('post_descricao').style.display = 'none';
        }
    }

    function validateLicensePlate(licensePlate){
        if(licensePlate.length < 5){
            document.getElementById('post_placa').style.display = 'block';
        } else{
            document.getElementById('post_placa').style.display = 'none';
        }
    }

    function getSearch(){
        let uriParam = document.getElementById('uriParamComplaint').value;
        let endPoint = document.getElementById('endPointComplaint').value;
        sessionStorage.setItem('uriParamComplaint', uriParam);
        sessionStorage.setItem('endPointComplaint', endPoint);
        window.location.href = "./search.html";
    }

    function handleFile(){
        var img = document.getElementById('selected-image');
        img.crossOrigin = 'Anonymous';

        img.onload = function () {
            var canvas = document.createElement('canvas'),
                ctx = canvas.getContext('2d');
                
            canvas.height = img.naturalHeight;
            canvas.width = img.natualWidth;
            ctx.drawImage(img, 0, 0);

            var uri = canvas.toDataURL('image/png'),
                b64 = uri.replace(/^data:image.+;base64,/, '');
            console.log(b64);
        }
    }

    function preencherFormulario(endereco) {
        uf.value = endereco.uf;
        city.value = endereco.localidade;
        district.value = endereco.bairro;
        
    }

    function eNumero(numero) {
        return /^[0-9]+$/.test(numero);
    }
    
    function cepValido(cep) {
        return cep.length == 8 && eNumero(cep);
    }

    const pesquisarCep = async () => {
        const cep = document.getElementById('cep').value.replace("-", "");
        const url = `https://viacep.com.br/ws/${cep}/json/`;

        if (cepValido(cep)) {
            const dados = await fetch(url);
            const endereco = await dados.json();
            if (endereco.hasOwnProperty('erro')) {
                document.getElementById('endereco_validator').value = 'CEP não encontrado!';
                document.getElementById('endereco_validator').style.display = 'block';
                document.getElementById('endereco_validator').innerHTML = 'CEP inválido';
            } else {
                preencherFormulario(endereco);
                bairro = endereco.bairro;
                document.getElementById('endereco_validator').style.display = 'none';
            }
        } else {
            document.getElementById('endereco_validator').value = 'CEP incorreto!';
            document.getElementById('endereco_validator').style.display = 'block';
            document.getElementById('endereco_validator').innerHTML = 'CEP inválido';
        }

    }

    function getId() {
        event.preventDefault();
        var config = {
            method: 'get',
            url: `http://localhost:8080/complaints/user/${sessionStorage.user_id}`,
            headers: {}
        };

        axios(config)
            .then(function (response) {
                let tamanhoData = response.data.length - 1;
                subirFoto(response.data[tamanhoData]["id"]);
            })
            .catch(function (error) {
                console.log(error);
            });

    }

    function subirFoto(id) {
        event.preventDefault();
        var input = document.querySelector('input[type="file"]');
        var formdata = new FormData();
        formdata.append("file", input.files[0]);

        var requestOptions = {
            method: 'PUT',
            body: formdata,
            redirect: 'follow'
        };

        fetch(`http://localhost:8080/complaints/archive/${sessionStorage.user_id}/${id}`, requestOptions)
            .then(response => response.text())
            .then(result => console.log(result))
            .catch(error => console.log('error', error));
    }

    //Aqui ele observa o cep e quando não está no foco, faz a pesquisa
    document.getElementById('cep')
    .addEventListener('focusout', pesquisarCep);

</script>