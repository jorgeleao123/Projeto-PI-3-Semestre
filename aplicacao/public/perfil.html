<!DOCTYPE html>
<html lang="pt">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="shortcut icon" href="assets/img/logo-go-blue.svg" type="image/png">
    <script src="https://kit.fontawesome.com/c9f71e3f63.js" crossorigin="anonymous"></script>
    <title>Perfil | GO</title>
    <link rel="stylesheet" href="./assets/css/perfil.css">
    <link rel="stylesheet" href="./assets/css/style-components.css">
    <link rel="stylesheet" href="./assets/css/style.modais.css">
    <link rel="stylesheet" href="./assets/css/style.nav.css">
    <link rel="stylesheet" href="./assets/css/feed.css">
    <script src="https://unpkg.com/axios/dist/axios.min.js"></script>



</head>

<body class="body__profile" onload="itensPublic(),notificacao()">
    <!------------------------------------------------------------------------- NAVBAR ------------------------------------------------------------------------->
    <!-- navbar desktop -->
    <section class="nav__desktop">
        <div class="nav__desktop__top">
            <div class="nav__desktop__top__items">
                <span id="logo">
                    <img src=".//assets/img/logo-go-carbon.svg" alt="">
                </span>
                <span class="nav__desktop__search">
                    <input type="search" id="uriParamComplaint" placeholder="Busque pela placa ou nome do motorista">
                    <select name="" id="endPointComplaint" aria-placeholder="Filtrar por">
                        <option value="license">Placa</option>
                        <option value="city">Cidade</option>
                        <option value="district">Bairro</option>
                        <option value="state">Estado</option>
                    </select>
                    <a class="search__icon" onclick="getSearch()"> <i
                            class="fa-solid fa-magnifying-glass icon__mobile__search"></i></a>
                </span>
            </div>
            <div class="nav__desktop__top__items">
                <div class="mobile-bottom-nav__item">
                    <div class="mobile-bottom-nav__item-content links__desktop">
                        <a href="./home.html"><i class="fa-solid fa-house icon__mobile"></i></a>
                    </div>
                </div>
                <div class="mobile-bottom-nav__item mobile-bottom-nav__item--active">
                    <div class="mobile-bottom-nav__item-content links__desktop">
                        <a href="./perfil.html"><i class="fa-solid fa-user icon__mobile link_active"></i></a>
                    </div>
                </div>

                <div class="nav__itens__links">
                    <div class="mobile-bottom-nav__item-content links__desktop">
                        <label for="modal-4" id="hasNotification">
                            <i class="fa-solid fa-bell icon__mobile"></i>
                        </label>
                    </div>
                </div>

                <div class="nav__itens__links">
                    <div class="mobile-bottom-nav__item-content">
                        <label for="modal-1">
                            <i class="fa-solid fa-caret-down icon__mobile js-open-modal"></i>
                        </label>
                    </div>
                </div>
                <div class="mobile-bottom-nav__item-content">
                    <div class="icon__user__initial">
                        <span class="initial__user" id="initial3">R</span>
                    </div>
                </div>
            </div>
        </div>
        </div>
    </section>

    <!-- navbar mobile -->
    <section class="nav__mobile">
        <div class="nav__mobile__top">
            <div class="">
                <div class="mobile-bottom-nav__item-content">
                    <span id="logoMobile">
                        <img src=".//assets/img/logo-go-carbon.svg" alt="">
                    </span>
                </div>
            </div>

            <div class="mobile-bottom-nav__item mobile-bottom-nav__item">
                <div class="mobile-bottom-nav__item-content">
                    <h3>Perfil</h3>
                </div>
            </div>

            <div class="">
                <div class="mobile-bottom-nav__item-content">
                    <label for="modal-4">
                        <i class="fa-solid fa-bell icon__mobile"></i>
                    </label>
                </div>
            </div>
        </div>
    </section>
    <!--------------------------------------------------------------------- /NAVBAR --------------------------------------------------------------------------->

    <!--------------------------------------------------------------------- CONTEUDO --------------------------------------------------------------------------->
    <main>
        <!-- Perfil navbar mobile -->
        <div class="f__navbar__mobile">
            <nav class="f__navbar">
                <ul>
                    <li><a id="active" href="./perfil.html"><i class="fa-solid fa-newspaper"></i><span
                                class="public">Publicações</span></a></li>
                    <li><a href="./perfil-save.html"><i class="fa-solid fa-bookmark"></i></i><span
                                class="public">Salvos</span></a></li>
                    <li><a href="./perfil-contestation.html"><i class="fa-solid fa-signal"></i><span
                                class="public">Contestação</span></a></li>
                </ul>
            </nav>
        </div>

        <!-- background card -->
        <div class="background">
            <div class="background__content"></div>
            <div class="card__perfil__mobile">
                <div class="flex padding__card">
                    <div class="icon__user icon__user__initial">
                        <span class="initial__user" id="initial2">R</span>
                    </div>
                    <span>
                        <h4 id="nameUser1" class="nameUser">Rafaella Kimberlly</h4>
                    </span>
                </div>
            </div>
        </div>

        <!-- card infos perfil -->
        <section class="content__feed">
            <div class="card__infos__perfil">
                <div class="card__flex padding__card">
                    <div class="icon__perfil icon__user__perfil">
                        <span class="initial__user" id="initial1"></span>
                    </div>
                    <div class="card__text">
                        <h4 id="nameUser2"></h4>
                        <span>
                            <p id="city"><i class="fa-solid fa-location-dot"></i>São Paulo - SP</p>
                            <br>
                        </span>
                        <button class="edit__button">
                            <a class="edit__input" href="./config-infos.html">Editar Perfil</a>
                        </button>
                    </div>

                </div>
                <div class="padding__card">
                    <div class="flex justify">
                        <h5>Publicações</h5>
                        <span id="data__pub" class="data__user"></span>
                    </div>
                    <div class="flex justify top">
                        <h5>Buscas</h5>
                        <span id="data__bus" class="data__user"></span>
                    </div>
                </div>
            </div>
            </div>

            <!------------------------------------------CONTENT FEED ------------------------------>
            <div id="itens" class="container__feed__perfil">
                <!------------------------------- publicação  ----------------------------------->

                <!------------------------------ /publicação  ----------------------------------------->
            </div>
            <!--------------------------------------------------------------------- / CONTENT FEED ---------------------------------------------------------->

            <!-- initial navbar right -->
            <div class="card__infos__navbar top__perfil">
                <nav class="i__navbar">
                    <ul>
                        <li><a id="activeleft" href="./perfil.html">Minhas Publicações</a></li>
                        <li><a href="./perfil-contestation.html">Minhas Contestações</a></li>
                        <li class="none"><a href="./perfil-save.html">Salvos</a></li>
                    </ul>
                </nav>



                <!-- Card  -->
                <div class="card__write">
                    <div class="flex">
                        <button class="edit__button__card"><a href="./new-publication.html">Escrever</a></button>
                    </div>

                    <div class="font__card">
                        <h6>Públique uma denúncia no seu perfil</h6>
                    </div>
                </div>
            </div>
        </section>

        <div style="display: none;" class="toggle">
            <input type="checkbox" id="switch" name="theme" onclick="mudar_logo()">
            <label for="switch">Toggle</label>
        </div>


        <!---------------------------------------------------------------------- MODAIS -------------------------------------------------------------------------->
        <!-- modal navbar / mains opções de link -->
        <input class="modal-state" id="modal-1" type="checkbox" />
        <div class="modal">
            <label class="modal__bg" for="modal-1"></label>
            <div class="modal__inner">
                <a class="options__modal__user" href="./perfil-save.html">Casos salvos</a>
                <a class="options__modal__user" href="./perfil-contestation.html">Denuncias em analise</a>
                <a class="options__modal__user" href="./config-infos.html">Configurações</a>
                <div class="hr"></div>
                <span class="flex justify">
                    <a class="options__modal__user" href="./login.html">Sair</a>
                    <i class="fa-solid fa-arrow-right-from-bracket"></i>
                </span>
            </div>
        </div>

        <!-- modal / notificações -->
        <input class="modal-state" id="modal-4" type="checkbox" />
        <div class="modal">
            <label class="modal__bg" for="modal-4"></label>
            <div class="modal__inner__notify padding__card" id="idNotificacao">
        </div>

        <!-- modal de busca -->
        <span class="display__modal">
            <input class="modal-state" id="modal-2" type="checkbox" />
            <div class="modal modal__search">
                <label class="modal__bg__search" for="modal-2"></label>
                <div class="modal__inner__search">
                    <div>
                        <p>Faça sua busca</p>
                        <span class="nav__mobile__input">
                            <input type="search" placeholder="Busque pela placa ou nome do motorista">
                            <select class="select__mobile" name="" id="" aria-placeholder="Filtrar por">
                                <option value="">Placa</option>
                                <option value="">Nome/Placa</option>
                                <option value="">Cidade</option>
                                <option value="">Bairro</option>
                                <option value="">Estado</option>
                            </select>
                            <a href="./search.html"
                                style="margin-top: 2px; padding-left: 10px; text-decoration: none; color: rgb(94, 94, 94);">
                                <i class="fa-solid fa-magnifying-glass icon__mobile__search"></i></a>
                        </span>
                    </div>
                </div>
            </div>
        </span>

    </main>

    <!----------------------------------------------------------------------- MENU -------------------------------------------------------------------------->
    <section class="nav__mobile">
        <nav class="mobile-bottom-nav">
            <div class="mobile-bottom-nav__item">
                <div class="mobile-bottom-nav__item-content">
                    <a href="./index.html"><i class="fa-solid fa-house icon__mobile"></i></a>
                </div>
            </div>
            <div class="nav__itens__links">
                <div class="mobile-bottom-nav__item-content">
                    <label for="modal-2">
                        <i class="fa-solid fa-magnifying-glass icon__mobile"></i>
                    </label>
                </div>
            </div>
            <div class="mobile-bottom-nav__item mobile-bottom-nav__item--active">
                <div class="mobile-bottom-nav__item-content">
                    <a href="./perfil.html"><i class="fa-solid fa-user icon__mobile"></i></a>
                </div>
            </div>

            <div class="nav__itens__links">
                <div class="mobile-bottom-nav__item-content">
                    <label for="modal-1">
                        <i class="fa-solid fa-angle-up icon__mobile"></i>
                    </label>
                </div>
            </div>
        </nav>
    </section>
    <script src="./assets/js/script-components.js"></script>
    <script src="./assets/js/dark-mode.js"></script>

    <script>
        var typeClass = "";
        function openEdit(id) {
            sessionStorage.editId = id;
            window.location.href = "./edit.html";
        }

        function deleteComplaint(id) {

            event.preventDefault();

            axios.delete(`http://localhost:8080/complaints/${id}`)
                .then((resp) => {
                    alert("Denuncia excluida com sucesso!");
                    window.location.reload();
                })
                .catch((err) => {

                })

        }

        function itensPublic() {
            document.getElementsByClassName("icon__user__initial")[0].style.backgroundColor = sessionStorage.user_colorProfile;
            document.getElementsByClassName("icon__user__initial")[1].style.backgroundColor = sessionStorage.user_colorProfile;
            document.getElementsByClassName("icon__user__perfil")[0].style.backgroundColor = sessionStorage.user_colorProfile;
            document.getElementsByClassName("background__content")[0].style.backgroundColor = sessionStorage.user_colorMenu;
            nameUser1.innerHTML = sessionStorage.user_nome
            nameUser2.innerHTML = sessionStorage.user_nome
            initial1.innerHTML = sessionStorage.user_nome[0]
            initial2.innerHTML = sessionStorage.user_nome[0]
            initial3.innerHTML = sessionStorage.user_nome[0]
            city.innerHTML = `${sessionStorage.user_city}- ${sessionStorage.user_district}`

            var config = {
                method: 'get',
                url: `http://localhost:8080/users/${sessionStorage.user_id}`,
            };

            axios(config)
                .then(function (response) {

                })
                .catch(function (error) {
                    console.log(error);
                });
            event.preventDefault();
            axios.get(`http://localhost:8080/complaints/user/${sessionStorage.user_id}`, {})
                .then((resp) => {
                    console.log(resp);
                    itens.innerHTML == '';
                    let contador = 0;
                    resp.data.map((e) => {
                        if (e["status"] != "Inativo") {
                            contador++;
                            itens.innerHTML += `                            
                            <div class="content__complaint">
                                    <div class="header__complaint flex justify">
                                        <div class="flex">
                                            <div class="icon__user__initial" style="background-color: ${e["user"]["colorProfile"]};">
                                                <span class="initial__user" id="initial">${e["user"]["name"][0]}</span>
                                            </div>
                
                                            <span class="infos__user__complaint">
                                                <h4 >${e["user"]["name"]}</h4>
                                                <p >${e["user"]["genre"]}</p>
                                            </span>
                                        </div>
                                        <!-- colocar no (for="{id}"} para cada publi ter o seu modal -->
                                        <label class="label__modal" for="${e["id"]}">
                                            <i class="fa-solid fa-ellipsis-vertical"></i>
                                        </label>
                                        <!----------- modal funcionalidades ----------->
                                        <!-- colocar no (id="{id}"} para cada publi ter o seu modal -->
                                        <input class="modal-state" id="${e["id"]}" type="checkbox" />
                                        <div class="modal__functions">
                                            <!-- colocar no (for="{id}"} para cada publi ter o seu modal -->
                                            <label class="" for="${e["id"]}"></label>
                                            <div class="modal__inner__func">
                                                <form action="">
                                                    <p style="cursor: pointer;" class="options__modal__user">
                                                        <input style="display: none; cursor: pointer;" type="submit"
                                                            class="option__modal__user" value="idCaso">
                                                            <span onclick="openEdit(${e['id']})">
                                                                Editar
                                                            </span>
                                                    </p>
                                                    <p style="cursor: pointer;" class="options__modal__user">
                                                        <input style="display: none; cursor: pointer;" type="submit"
                                                            class="option__modal__user" value="idCaso">
                                                        <span onclick="deleteComplaint(${e['id']})">
                                                            Excluir
                                                        </span>
                                                    </p>
                                                </form>
                                            </div>
                                        </div>
                                    </div>
                
                                    <div class="infos__complaint">
                                        <p id="textComplaint">
                                            ${e["description"]}
                                        </p>
                                    </div>
                
                                    <div class="photos__complaint">
                                        <div class="item shrink-1-basis">
                                            <img src="http://localhost:8080/complaints/archive/${e['id']}" alt="" onerror="this.src='.//assets/img/logo-go-carbon.svg';" >
                                        </div>
                                    </div>
                
                                    <div class="more__infos__complaint flex justify">
                                        <div class="classification__complaint">
                                            <div class="${getPublicationType(e["type"], typeClass)}"></div>
                                            <h6>Classificação do caso: <span id="classificationPub">${e["type"]}</span></h6>
                                        </div>
                                        <span class="location__conplaint" id="locationComplaint">
                                            ${e["address"]["state"]} - ${e["address"]["city"]} | ${e["dateTimeComplaint"]}
                                        </span>
                                    </div>
                                    <div class="hr margin-bottom"></div></div>`

                        }
                        
                    });
                    data__pub.innerHTML = contador;
                    data__bus.innerHTML = sessionStorage.qnt_Buscas;
                })
                .catch((error) => {
                    console.log(error);
                    console.log(data);
                    window.location.href = './error.html';
                })

        }


        function getPublicationType(type, typeClass) {
            switch (type) {
                case "Assédio":
                    typeClass = "circle__assedio circle__classification";
                    break;
                case "Assédio Moral":
                    typeClass = "circle__assedio__moral circle__classification";
                    break;
                case "Racismo":
                    typeClass = "circle__racism circle__classification";
                    break;
                case "Agressão Física":
                    typeClass = "circle__agressao__fisica circle__classification";
                    break;
                case "Agressão Verbal":
                    typeClass = "circle__agressao__verbal circle__classification";
                    break;
                case "Homofobia":
                    typeClass = "circle__homofobia circle__classification";
                    break;
                case "Preconceito":
                    typeClass = "circle__preconceito circle__classification";
                    break;
                case "Furto":
                    typeClass = "circle__furto circle__classification";
                    break;
                default:
                    typeClass = "circle__preconceito circle__classification";
                    break;
            }
            return typeClass;
        }

    </script>
</body>
<script>
    function getSearch() {
        let uriParam = document.getElementById('uriParamComplaint').value;
        let endPoint = document.getElementById('endPointComplaint').value;
        sessionStorage.setItem('uriParamComplaint', uriParam);
        sessionStorage.setItem('endPointComplaint', endPoint);
        window.location.href = "./search.html";
    }

    function notificacao() {
        event.preventDefault();

        var config = {
            method: 'get',
            url: `http://localhost:8080/notifications/user/${sessionStorage.getItem('user_id')}`,
        };

        axios(config)
            .then(function (response) {

                response.data.map((e) => {
                    if (!e["hasViewed"]) {
                        hasNotification.innerHTML = `<img class="pegaclasse" src="./assets/img/notification.png" alt="">`;
                        idNotificacao.innerHTML += `<div class="content__notify">
                    <h5>${e["title"]}</h5>
                    <span class="date">${e["dateTimeNotification"]}</span>
                    <p>${e["description"]}</p>
                    <div class="hr top"></div>
                </div>`;

                        idNotificacao.innerHTML += `<a class="excnoti" onclick="zeraNotificacao()">excluir notificações</a>`;
                    }

                })

            })
            .catch(function (error) {
                console.log(error);
            });

    }

    function zeraNotificacao() {
        event.preventDefault();

        var config = {
            method: 'patch',
            url: `http://localhost:8080/notifications/view/${sessionStorage.getItem('user_id')}`,
        };

        axios(config)
            .then(function (response) {
                console.log(JSON.stringify(response.data));
                console.log("foi");
                window.location.href = "./perfil.html";
            })
            .catch(function (error) {
                console.log(error);
            });
    }

   
</script>

</html>